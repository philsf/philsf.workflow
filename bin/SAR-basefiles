#!/bin/bash

# ============================================================
# Script:   SAR-basefiles
# Purpose:  Copy core R scripts, templates, and setup files
#           from the master SAR repository template to the local directory.
#
# Note:     N/A
#
# Version:  0.xx.x
# Author:   Felipe Figueiredo
# Created:  2025-11-11
#
# ------------------------------------------------------------
# QC Date:  YYYY-MM-DD
# ------------------------------------------------------------
# ============================================================

SAR=${PWD##*/} # local dir
SAR_CODE=${SAR/SAR-/""}
SAR_LANG="en"
OPTIND=1

while getopts "l:h" opt; do
    case $opt in
	l) SAR_LANG=${OPTARG}
	   if [[  "$SAR_LANG" != "pt" && "$SAR_LANG" != "en" ]]; then
	       echo "Supported languagues: pt and en (received $SAR_LANG)"
	       exit
	   fi
	   ;;
	h) #display help syntax
	    echo "help syntax"
	    exit 0
	    ;;
	\?) # Invalid option
            echo "Error: Invalid option"
            exit 0
	    ;;
    esac
done

RSCRIPTS="
00_setup_global.R
05_sample_size_calculation.R
06_output_table_shells.R
10_data_prep.R
15_imputation.R
20_data_descriptive_ads.R
21_output_descriptive_table.R
22_output_descriptive_plot.R
30_data_primary_ads.R
31_analysis_primary_model.R
32_output_primary_table.R
33_output_primary_plot.R
34_output_primary_table_univar.R
35_analysis_primary_sensitivity.R
36_output_primary_sens_table.R
40_data_secondary_ads.R
41_analysis_secondary_model.R
42_output_secondary_table.R
43_output_secondary_plot.R
50_data_exploratory_ads.R
51_analysis_exploratory_model.R
52_output_exploratory_table.R
53_output_exploratory_plot.R
90_outputs_tables.R
91_outputs_plots.R
95_cache_results.R
96_load_cached_results.R
99_full_analysis_run.R
README-R.md
"
cp ~/usr/SAR/gitignore .gitignore
cp ~/usr/SAR/new-rproj $SAR.Rproj
for r in $RSCRIPTS; do cp ~/usr/SAR/$r scripts/; done

echo "Installing templates for language: ${SAR_LANG}"

# rename scripts README
mv scripts/README-R.md scripts/README.md

# apply default template repo README
cp ~/usr/SAR/README-SAR_${SAR_LANG}.md README.md

# apply default template repo Portfolio
cp ~/usr/SAR/Portfolio_${SAR_LANG}.md Portfolio.md

# apply default SAP/SAR templates
cp ~/usr/SAR/SAP_${SAR_LANG}.Rmd report/SAP-$SAR_CODE-v01.Rmd
cp ~/usr/SAR/SAR_${SAR_LANG}.Rmd report/SAR-$SAR_CODE-v01.Rmd
cp -a ~/usr/SAR/misc/*${SAR_LANG}.docx report/misc/

# update links
SAR-links $SAR_CODE
